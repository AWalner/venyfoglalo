<!DOCTYPE html>
<html>
<head>
 <link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,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">
<link rel="shortcut icon" type="image/png" href="data:image/png;base64,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">





  <style>
    body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
 background: #f3f3f3;
color: #2f3e42;

}

.container {
  max-width: 520px;
  margin: 0 auto;
  padding: 20px 16px 30px 16px;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.08);
  background: white;
}

    input, select, textarea, button {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  border: 1px solid #ccc;
  border-radius: 6px;
  box-sizing: border-box;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-size: 15px;
  min-height: 48px;
}
.gdpr-box a:hover {
  background: #e9eef3;
  padding: 2px 4px;
  border-radius: 4px;
}
input:focus,
select:focus,
textarea:focus {
  outline: none;
  border-color: #5c9ed6;
box-shadow: 0 0 0 3px rgba(92,158,214,0.2);

}
.suggestions {
  border: 1px solid #ddd;
  border-radius: 8px;
  overflow: hidden;
  margin-top: -5px;
}

.suggestions div {
  padding: 10px;
  font-size: 14px;
}

textarea {
  min-height: 48px;
  resize: vertical;
}

    .info-box { background: #e9eef3; border-left: 5px solid #5c9ed6;; margin-top: 10px; }
    .suggestions div:hover { background:#f1f1f1; }
    .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.85em; font-weight: bold; }
    .recept { background: #ffcccc; color: #cc0000; }
    .veny-nelkul { background: #ccffcc; color: #006600; }
    button { background: #5c9ed6; color: white; border: none; cursor: pointer; font-weight: bold; }
    button:disabled { background:#aac9e8; }
    .gdpr-box { font-size: 12px; color: #555; margin-top: 10px; }
    .add-btn { background:#5c9ed6; margin-top:10px; }
    .delete-btn {
  background: #dc3545;
  width: auto !important;
  padding: 6px 12px;
  font-size: 13px;
  min-height: auto !important;
  height: auto !important;
  margin: 0;
}


    .med-block { border-top:1px solid #ddd; margin-top:20px; padding-top:20px; position:relative; }

    .error-field { border:2px solid #dc3545 !important; background:#fff5f5; }
    .error-message { color:#dc3545; font-size:13px; margin-top:-6px; margin-bottom:8px; }
    /* ===== MODERN SUCCESS UI ===== */

.success-wrapper {
  text-align:center;
  padding:20px 10px 30px 10px;
  animation: fadeIn .4s ease;
}

.success-icon {
  width:80px;
  height:80px;
  margin:20px auto;
  background:#5c9ed6;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:40px;
  color:white;
  box-shadow:0 8px 25px rgba(92,158,214,0.4);
  animation: pop .4s ease;
}

@keyframes pop {
  0% { transform:scale(0.5); opacity:0; }
  80% { transform:scale(1.1); }
  100% { transform:scale(1); opacity:1; }
}

.success-box {
  background:#e9eef3;
  border-left:5px solid #5c9ed6;
  padding:15px;
  border-radius:8px;
  margin:20px 0;
  font-size:14px;
}

.secondary-btn {
  background: #e9eef3;
  border: 2px solid #2f3e42;
  color: #2f3e42;
  font-weight: bold;
  margin-top: 10px;
}


.secondary-btn:hover {
  background:#2f3e42;
  color:white;
}
.header-card {
  background: #f8f9fa;
  padding: 22px;
  border-radius: 14px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.06);
  text-align: center;
  margin-bottom: 25px;
}

.header-title {
  font-size: 24px;
  font-weight: 700;
  color: #222;
  margin-bottom: 8px;
}

.header-sub {
  font-size: 14px;
  color: #555;
  line-height: 1.6;
}

.header-link {
  display: inline-block;
  margin-top: 12px;
  font-size: 14px;
  font-weight: 600;
  color: #2f3e42;
  text-decoration: none;
  background: #e9eef3;
  padding: 8px 16px;
  border-radius: 20px;
  transition: 0.2s;
}

}

.header-link:hover {
  background: #d8e6f2;
}

.warning-box {
  margin-top: 15px;
  padding: 12px 16px;
  background: #fff3cd;
  border-left: 4px solid #ffc107;
  border-radius: 8px;
  font-size: 13px;
  color: #856404;
}
/* ===== MODERN HEADER ===== */

.header-modern {
  text-align: center;
  margin-bottom: 25px;
}

.header-title {
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 8px;
  color: #222;
}

.header-sub {
  font-size: 14px;
  color: #666;
  line-height: 1.5;
}

.header-warning {
  margin-top: 15px;
  font-size: 13px;
  background: #e9eef3;
  border-left: 4px solid #5c9ed6;
  padding: 10px 12px;
  border-radius: 6px;
  color: #2f3e42;
}

.header-link {
  display: inline-block;
  margin-top: 14px;
  padding: 8px 16px;
  border-radius: 20px;
  background: #e9eef3;
  color: #2f3e42;
  font-weight: 600;
  text-decoration: none;
  transition: 0.2s ease;
}


.header-link:hover {
  text-decoration: underline;
}
/* ===== EXTRA MOBIL OPTIMALIZ√ÅL√ÅS ===== */

@media (max-width: 480px) {

  .container {
    border-radius: 0;
    box-shadow: none;
    padding: 16px 14px 25px 14px;
  }

  .header-title {
    font-size: 20px;
  }

  .header-sub {
    font-size: 13px;
  }

  button {
    font-size: 16px;
  }

  .delete-btn {
    font-size: 13px;
    padding: 8px 10px;
  }

  .add-btn {
    font-size: 15px;
  }

  .success-icon {
    width: 70px;
    height: 70px;
    font-size: 32px;
  }

  .success-box {
    font-size: 13px;
  }
}
.med-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
}

  </style>
</head>
<body>

<div class="container">

<div class="header-modern">

  <div class="header-title">
    Gy√≥gyszer foglal√°s
  </div>

  <div class="header-sub">
    <strong>Szent Gy√∂rgy Gy√≥gyszert√°r</strong><br>
    8060 M√≥r, K√∂zt√°rsas√°g t√©r 1.<br>
    üìû 06 22 407 036
  </div>

  <a href="https://gyogyszertarmor.hu" target="_blank" class="header-link">
    ‚Üê Vissza a honlapra
  </a>

  <div class="header-warning">
    V√©nyk√∂teles gy√≥gyszer kiz√°r√≥lag √©rv√©nyes orvosi v√©ny ellen√©ben v√°lthat√≥ ki.
  </div>

</div>



<div id="medicineContainer"></div>
<button class="add-btn" onclick="addMedicineBlock()">‚ûï Tov√°bbi k√©sz√≠tm√©ny hozz√°ad√°sa</button>

<div style="margin-top:20px;">
  <label><strong>Az √ñn adatai:</strong></label>
  <input type="text" id="userName" placeholder="Teljes n√©v(k√∂telez≈ë)">
  <input type="email" id="userEmail" placeholder="Email c√≠m(k√∂telez≈ë)" oninput="this.value=this.value.toLowerCase()">

  <!-- HONEYPOT MEZ≈ê (REJTETT) -->
  <input type="text" id="website" style="display:none">

  <div class="gdpr-box">
    <label style="display:flex; align-items:flex-start; gap:8px;">
  <span>
    Hozz√°j√°rulok ahhoz, hogy a <strong>Szent Gy√∂rgy Gy√≥gyszert√°r</strong>
    a megadott szem√©lyes adataimat kezelje.
  </span>
  <input type="checkbox" id="gdprConsent">
</label>


    <div style="margin-top:6px;">
      <a href="<?= ScriptApp.getService().getUrl() ?>?page=adatkezeles"
         target="_blank"
         style="font-size:12px; color:#2f3e42; font-weight:600;"
>
         Adatkezel√©si t√°j√©koztat√≥
      </a>
    </div>
  </div>

  <button id="submitBtn" onclick="submitBooking()">Foglal√°s lead√°sa</button>
</div>

</div>

<script>

let blockCounter = 0;
let medicinesData = {};
let formStartTime = Date.now(); // ID≈êALAP√ö V√âDELEM

function addMedicineBlock() {
  blockCounter++;
  const container = document.getElementById("medicineContainer");

  const block = document.createElement("div");
  block.className = "med-block";
  block.id = "block_" + blockCounter;

  block.innerHTML = `
    <div class="med-header">
  <label><strong>K√©sz√≠tm√©ny neve:</strong></label>
  <button type="button" class="delete-btn" onclick="removeMedicineBlock(${blockCounter})">
    üóë T√∂rl√©s
  </button>
</div>

    <input type="text" placeholder="Pl.: Amlodipin" oninput="searchMed(this, ${blockCounter})">
    <div class="suggestions"></div>

    <label><strong>V√°lasszon kiszerel√©st:</strong></label>
    <select>
      <option value="">-- K√©rj√ºk, v√°lasszon --</option>
    </select>

    <label><strong>V√°lasszon mennyis√©get:</strong></label>
    <select class="quantity">
      <option value="">-- K√©rj√ºk, v√°lasszon --</option>
      ${[...Array(14)].map((_,i)=>`<option>${i+1} doboz</option>`).join("")}
      ${[...Array(10)].map((_,i)=>`<option>${i+1} ampulla</option>`).join("")}
    </select>

    <label><strong>Nem tal√°lja a list√°ban? √çrja be ide (nem k√∂telez≈ë):</strong></label>
    <textarea class="customInput" placeholder="Gy√≥gyszer pontos neve, ha nem szerepel a list√°ban"></textarea>

    <div class="info-box" style="display:none;"></div>

  `;

  container.appendChild(block);
}

function removeMedicineBlock(id){
  const blocks = document.querySelectorAll(".med-block");
  if(blocks.length <= 1){
    alert("Legal√°bb egy k√©sz√≠tm√©nynek szerepelnie kell.");
    return;
  }
  if(!confirm("Biztosan t√∂r√∂lni szeretn√© ezt a k√©sz√≠tm√©nyt?")) return;

  const block = document.getElementById("block_" + id);
  if(block) block.remove();
  delete medicinesData[id];
}

function searchMed(input, blockId){
  const query = input.value.trim();
  const suggestionsDiv = input.parentNode.querySelector(".suggestions");
  suggestionsDiv.innerHTML = "";
  if(query.length < 2) return;

  google.script.run.withSuccessHandler(function(results){
    suggestionsDiv.innerHTML = "";
    results.forEach(function(name){
      const item = document.createElement("div");
      item.style.padding = "6px";
      item.style.cursor = "pointer";
      item.style.borderBottom = "1px solid #eee";
      item.innerText = name;

      item.onclick = function(){
        input.value = name;
        suggestionsDiv.innerHTML = "";
        loadDetails(name, blockId);
      };
      suggestionsDiv.appendChild(item);
    });
  }).getUniqueMedicines(query);
}

function loadDetails(medName, blockId){
  google.script.run.withSuccessHandler(function(details){
    medicinesData[blockId] = {};
    const block = document.getElementById("block_" + blockId);
    const select = block.querySelector("select");
    const infoBox = block.querySelector(".info-box");

    select.innerHTML = `<option value="">-- K√©rj√ºk, v√°lasszon --</option>`;
    infoBox.style.display = "none";

    details.forEach(function(item, index){
      medicinesData[blockId][index] = item;
      const option = document.createElement("option");
      option.value = index;
      option.textContent = item.kiszereles;
      select.appendChild(option);
    });

    select.onchange = function(){
      const selected = medicinesData[blockId][this.value];
      if(selected){
        infoBox.style.display = "block";
        infoBox.innerHTML = `
          <strong>Hat√≥anyag:</strong> ${selected.hatoanyag}<br>
          <strong>Kateg√≥ria:</strong> ${selected.kiadhatosag}
        `;
      } else {
        infoBox.style.display = "none";
      }
    };
  }).getDetails(medName);
}

function showError(field,message){
  field.classList.add("error-field");
  const msg=document.createElement("div");
  msg.className="error-message";
  msg.innerText=message;
  field.parentNode.insertBefore(msg,field.nextSibling);
}

function clearErrors(){
  document.querySelectorAll(".error-field").forEach(f=>f.classList.remove("error-field"));
  document.querySelectorAll(".error-message").forEach(m=>m.remove());
}
function showSuccessUI(){
  const container = document.querySelector(".container");
  container.innerHTML = `
    <div class="success-wrapper">
      <div class="success-icon">‚úì</div>

      <h2 style="color:#2f3e42;">Foglal√°s√°t r√∂gz√≠tett√ºk!</h2>

      <div class="success-box">
        A foglal√°s m√©g nem min≈ës√ºl meger≈ës√≠tett rendel√©snek.<br>
        Hamarosan e-mailben visszajelz√ºnk.
      </div>

      <button onclick="location.reload()">√öj foglal√°s ind√≠t√°sa</button>

      <button class="secondary-btn" onclick="window.open('http://gyogyszertarmor.hu', '_blank');">
  Vissza a honlapra
</button>
    </div>
  `;

  window.scrollTo({top:0, behavior:"smooth"});
}

function submitBooking(){

  clearErrors();
  let medicines=[];
  let hasError=false;

  document.querySelectorAll(".med-block").forEach(block=>{
    const name=block.querySelector("input");
    const pack=block.querySelector("select");
    const quantity=block.querySelector(".quantity");
const custom=block.querySelector(".customInput");
const blockId = block.id.split("_")[1];


    if(!name.value.trim()){ showError(name,"K√∂telez≈ë kit√∂lteni."); hasError=true; }
    if(pack.value===""){ showError(pack,"K√∂telez≈ë kiv√°lasztani."); hasError=true; }
    if(quantity.value===""){ showError(quantity,"K√∂telez≈ë kiv√°lasztani."); hasError=true; }

   if(
  name.value &&
  pack.value!=="" &&
  quantity.value &&
  medicinesData[blockId] &&
  medicinesData[blockId][pack.value]
){
  const data = medicinesData[blockId][pack.value];

      medicines.push({
  name:name.value,
  pack:data.kiszereles,
  quantity:quantity.value,
  hatoanyag:data.hatoanyag,
  status:data.kiadhatosag,
  custom: custom.value ? custom.value.trim() : ""
});

    }
  });

  const userName=document.getElementById("userName");
  const userEmail=document.getElementById("userEmail");
  const gdpr=document.getElementById("gdprConsent");

  if(!userName.value.trim()){ showError(userName,"K√∂telez≈ë kit√∂lteni."); hasError=true; }
  if(!userEmail.value.trim()){ 
  showError(userEmail,"K√∂telez≈ë kit√∂lteni."); 
  hasError=true; 
} else {

  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  if(!emailPattern.test(userEmail.value.trim())){
    showError(userEmail,"√ârv√©nyes email c√≠met adjon meg (pl. nev@email.hu).");
    hasError = true;
  }

}

  if(!gdpr.checked){ showError(gdpr,"K√∂telez≈ë elfogadni."); hasError=true; }

  if(hasError) return;

  const btn=document.getElementById("submitBtn");
  btn.disabled=true;
  btn.innerText="K√ºld√©s...";

  const formTime = Date.now() - formStartTime;

  google.script.run
  .withSuccessHandler(function(){
    showSuccessUI();
  })
  .withFailureHandler(function(err){
    alert("Hiba t√∂rt√©nt: " + err.message);
    btn.disabled=false;
    btn.innerText="Foglal√°s lead√°sa";
  })
  .processBooking({

    userName:userName.value,
    userEmail:userEmail.value,
    medicines:medicines,
    honeypot:document.getElementById("website").value,
    formTime:formTime
  });
}

addMedicineBlock();

function getQueryParam(name) {
  const params = new URLSearchParams(window.location.search);
  return params.get(name);
}

function prefillCancelFromUrl() {
  const orderId = getQueryParam("orderId");
  const orderEl = document.getElementById("cancelOrderId");

  if (orderId && orderEl) {
    orderEl.value = orderId;

    // NEM m√≥dos√≠that√≥:
    orderEl.readOnly = true;     // nem tud bele√≠rni
    orderEl.disabled = true;     // m√©g a kurzor se megy bele (extra biztos)

    // Ha disabled, elk√ºld√©skor nem ker√ºlne be automatikusan, ez√©rt mi JS-b≈ël √∫gyis kiolvassuk.
    // (A requestCancel() a DOM-b√≥l olvassa, ez m≈±k√∂dni fog.)

    const section = document.getElementById("cancelSection");
    if (section) section.scrollIntoView({ behavior: "smooth" });
  }
}

window.addEventListener("load", prefillCancelFromUrl);

function requestCancel() {
  var orderId = document.getElementById("cancelOrderId").value.trim();
  var email = document.getElementById("cancelEmail").value.trim();
  var confirm = document.getElementById("cancelConfirm").checked;
  var resultEl = document.getElementById("cancelResult");

  resultEl.textContent = "";

  if (!orderId) {
    resultEl.textContent = "Hi√°nyzik az OrderID. K√©rlek az emailben l√©v≈ë t√∂rl√©s linket haszn√°ld.";
    return;
  }

  if (!email) {
    resultEl.textContent = "K√©rlek add meg az email c√≠met.";
    return;
  }

  if (!confirm) {
    resultEl.textContent = "K√©rlek pip√°ld be, hogy biztosan t√∂r√∂lni szeretn√©d.";
    return;
  }

  resultEl.textContent = "T√∂rl√©s folyamatban...";

  google.script.run
    .withSuccessHandler(function(res) {
      if (res && res.ok) {
        resultEl.textContent = res.message || "Sikeres t√∂rl√©s.";
      } else {
        resultEl.textContent = (res && res.message) ? res.message : "Nem siker√ºlt t√∂r√∂lni.";
      }
    })
    .withFailureHandler(function(err) {
      resultEl.textContent = "Hiba t√∂rt√©nt: " + (err && err.message ? err.message : err);
    })
    .cancelBooking({ orderId: orderId, email: email });
}

</script>

<hr style="margin: 30px 0;">

<div id="cancelSection"></div>
<h3>Foglal√°s t√∂rl√©se</h3>
<p>Ha t√∂r√∂lni szeretn√©d a foglal√°sod, add meg az email c√≠medet. (Az OrderID-t a link automatikusan kit√∂lti.)</p>

<label>OrderID</label><br>
<input type="text" id="cancelOrderId" style="width: 100%; max-width: 420px;"><br><br>

<label>Email</label><br>
<input type="email" id="cancelEmail" placeholder="pl. te@email.hu" style="width: 100%; max-width: 420px;"><br><br>

<label>
  <input type="checkbox" id="cancelConfirm">
  Biztosan t√∂r√∂lni szeretn√©m a foglal√°st.
</label><br><br>

<button type="button" onclick="requestCancel()">Foglal√°s t√∂rl√©se</button>

<p id="cancelResult" style="margin-top: 10px;"></p>
</body>
</html>
